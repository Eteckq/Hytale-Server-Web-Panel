FROM eclipse-temurin:25-jdk-noble


# ============================================================
# Environment Variables
# ============================================================
ENV JAVA_MIN_RAM="3G" \
    JAVA_MAX_RAM="4G"

# ============================================================
# Install dependencies
# ============================================================
RUN apt-get update && apt-get install -y --no-install-recommends \
    curl \
    wget \
    unzip \
    jq \
    tzdata \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*
# Note: Timezone is set at runtime in entrypoint.sh using TZ env variable

# ============================================================
# Create directories
# ============================================================
RUN  mkdir -p /opt/hytale/server \
                /opt/hytale/data \
                /opt/hytale/backups \
                /opt/hytale/downloader

WORKDIR /opt/hytale

# ============================================================
# Copy scripts
# ============================================================
COPY --chmod=755 scripts/entrypoint.sh /opt/hytale/entrypoint.sh
COPY --chmod=755 scripts/start-server.sh /opt/hytale/start-server.sh

# ============================================================
# Expose UDP port (QUIC protocol)
# ============================================================
EXPOSE 5520/udp

# ============================================================
# Health check
# ============================================================
HEALTHCHECK --interval=60s --timeout=10s --start-period=180s --retries=3 \
    CMD pgrep -f "HytaleServer.jar" > /dev/null || exit 1

ENTRYPOINT ["/opt/hytale/entrypoint.sh"]
